# Задание
## Задача
Реализовать систему для добавления и чтения постов и комментариев с использованием GraphQL, аналогичную комментариям к постам на популярных платформах, таких как Хабр или Reddit.
## Функциональность
### Просмотр списка постов
```
query{
  posts{
    ...
  }
}
```
### Просмотр поста и комментариев под ним
```
query{
  post(id: {int}){
    comments{
      ...
    }
  }
}
```
### Пользователь, написавший пост, может запретить оставление комментариев. Система добавления комментариев
Модель поста содержит поле closed, система добавления комментариев привязана к посту, где идет проверка по выборке из бд, не закрыт ли пост и существует ли он. Проверка на длину сообщения происходит при помощи директивы на поле text.
```
mutation{
  createComment(input: {NewComment}) {
    ...
  }
}
```
NewComment состоит из данных комментария, айди предка(необязательное) и айди поста

### Подписка на добавление комментариев к определенному посту
```
subscription{
  newComments(postId: {int}){
    ...
  }
}
```
### Иерархия комментариев
#### Запрос получения поста и комментариев к нему (в этом случае выбираются комментарии к посту без предка)
```
query{
  post(id: {int}){
    comments{
      ...
    }
  }
}
```
#### Запрос на получение ответов на комментарий (выборка только по айди переданного комментария, выдается вложенный набор)
```
query{
  comment(id :{int}{
    comments{
      ...
    }
  }
}
```
### Пагинация
Пагинация настроена на posts и comments, на выход даются edges и pageinfo. Edges содержит массив нод, в котором сущность и его курсор. PageInfo содержит курсор конца выборки и ее начала, и имеется ли следующая страница. Пример:
```
query {
  posts(first: {int #can be nil}, after: {int #can be nil){
    edges {
      node {
        id
        title
        text
        closed
        createdAt
      }
      cursor
    }
    pageInfo {
      startCursor
      endCursor
      hasNextPage
    }
  }
}
```
or
```
query{
  post(id: {int}){
    comments(first: {int}, after: {int}){
          edges{
            node{
              id
              text
              parentId
              articleId
            }
            cursor
          }
          pageInfo {
      			startCursor
     				endCursor
      			hasNextPage
    			}
        }
    }
}
```
Значение first и after можно не передавать, в случае с first - дефолт значение 10, в случае after - будет означать, что выборка ведется без пропусков
### Выбор хранилища должен быть определяемым параметром при запуске сервиса
Выбор определяется из env vars, для изменения можно поменять значение db на {postgres, in-memory}
### Проблема N+1 и вложенности запросов
Проблема n+1 вложенного запроса comments решается при помощи dataloaden (github.com/vektah/dataloaden)

Проблема вложенности решается заданной сложностью запроса (HandlerExtension) при конструировании хэндлера
# Запуск
Сборка и запуск контейнеров приложения и Postgres:
```
docker-compose up
```
